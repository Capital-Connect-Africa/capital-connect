<ng-container *ngIf="subscribe$ | async"/>
<ng-container *ngIf="recentPayment$ | async"/>
<ng-container *ngIf="subscriptionTiers$ | async"/>

<div *ngIf="billing_enabled" class="px-4 pb-16 pt-10 bg-slate-50 rounded">
    <div class="top__bar">
        <h2 class="uppercase">Choose your plan</h2>
        <p class="text-[14px] font-thin">Choose a plan that best suits your business</p>
    </div>
    <ul class="grid grid-cols-4 gap-4 items-center">
        <li *ngFor="let tier of tiers" class="bg-white p-4 rounded-xl flex flex-col justify-between gap-4 h-full tier">
            <div class="w-full flex flex-col gap-4">
                <div class="text-[#7953dc] font-bold uppercase">{{tier.name | uppercase}} Plan</div>
                <h3 >{{tier.price | numberabbreviation | currency}}</h3>
                <div class="w-full">
                    <button class="py-3 block w-full text-[#13501B] rounded action__button" [ngClass]="{'bg-yellow-700 text-white border-yellow-700': paymentAttempt?.userSubscription?.subscriptionTier?.id ==tier.id}" (click)="subscribe(tier.id, !!paymentAttempt)" *ngIf="tier.name !==signalService.activePlan()">
                        {{paymentAttempt?.userSubscription?.subscriptionTier?.id ==tier.id? paymentAttempt?.status?.toString()?.toLowerCase() ==paymentStatus.FAILED? 'Retry': 'Continue': 'Choose Plan'}}
                    </button>
                    <button class="py-3 block w-full text-white bg-[#13501B] rounded action__button selected" *ngIf="(tier.name ==signalService.activePlan())">Current Plan</button>
                </div>
                    <div class="font-light inner__html">{{tier.description}}</div>
             
                    <ul class="feature-list">
                        <li *ngFor="let feature of tier.features">{{ feature }}</li>
                    </ul>
            </div>
            <div class="w-full">
                <button class="py-3 block w-full text-[#13501B] rounded action__button" [ngClass]="{'bg-yellow-700 text-white border-yellow-700': paymentAttempt?.userSubscription?.subscriptionTier?.id ==tier.id}" (click)="subscribe(tier.id, !!paymentAttempt)" *ngIf="tier.name !==signalService.activePlan()">
                    {{paymentAttempt?.userSubscription?.subscriptionTier?.id ==tier.id? paymentAttempt?.status?.toString()?.toLowerCase() ==paymentStatus.FAILED? 'Retry': 'Continue': 'Choose Plan'}}
                </button>
                <button class="py-3 block w-full text-white bg-[#13501B] rounded action__button selected" *ngIf="(tier.name ==signalService.activePlan())">Current Plan</button>
            </div>
        </li>
    </ul>
</div>

<p-dialog header="Subscribe" [modal]="true" [(visible)]="signalService.userHasInitiatedPayment" styleClass="rounded-md modal p-8 bg-white shadow w-[90%] lg:w-[75%] xl:w-[50%] h-full">
    <span class="font-light text-[14px]" *ngIf="plan">Selected Tier: <b>{{plan | titlecase}}</b></span>
    <div class="h-[90%]">
        <iframe [src]="redirectURL" width="100%" height="100%" *ngIf="redirectURL"></iframe>
    </div>
</p-dialog>